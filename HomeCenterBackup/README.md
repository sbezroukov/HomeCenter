# HomeCenter Backup Manager

Windows Forms приложение для управления бэкапами SQLite базы данных в Docker контейнере.

![HomeCenter Backup Manager](screenshot.png)

## Возможности

### Вкладка "Бэкапы"
- ✅ Создание бэкапа с датой и временем
- ✅ Восстановление из любого бэкапа
- ✅ Просмотр списка всех бэкапов
- ✅ Удаление выбранного бэкапа
- ✅ Автоматическая очистка старых бэкапов (>30 дней)
- ✅ Безопасное восстановление (создаёт бэкап перед восстановлением)

### Вкладка "Docker управление"
- ✅ Проверка статуса контейнера
- ✅ Остановка контейнера
- ✅ Запуск контейнера
- ✅ Перезапуск контейнера
- ✅ Просмотр логов контейнера

### Вкладка "Сборка приложения"
- ✅ Быстрая пересборка (docker-compose up -d --build)
- ✅ Полная пересборка (down + up --build)
- ✅ Пересборка без кэша (build --no-cache)
- ✅ Обновление базовых образов (pull + build)
- ✅ Очистка старых образов (image prune)

### Общее
- ✅ Лог операций в реальном времени
- ✅ Прогресс-бар для длительных операций
- ✅ Подтверждение опасных операций

## Требования

- Windows 10/11
- .NET 8.0
- Docker Desktop (запущен)
- Docker контейнер с базой данных

## Сборка

```bash
dotnet build
```

## Запуск

```bash
dotnet run
```

Или запустить скомпилированный exe:

```bash
.\bin\Debug\net8.0-windows\HomeCenterBackup.exe
```

## Использование

### 1. Настройки Docker

- **Имя контейнера**: Имя Docker контейнера (по умолчанию: `homecenter`)
- **Путь к БД**: Путь к базе данных внутри контейнера (по умолчанию: `/app/data/quiz.db`)
- **Папка бэкапов**: Автоматически создаётся в директории приложения

### 2. Создание бэкапа

1. Убедитесь что Docker контейнер запущен
2. Нажмите кнопку **"Создать бэкап"**
3. Бэкап будет сохранён с именем `quiz-YYYYMMDD-HHMMSS.db`

### 3. Восстановление

1. Выберите бэкап из выпадающего списка
2. Нажмите кнопку **"Восстановить"**
3. Подтвердите операцию
4. Приложение автоматически:
   - Создаст бэкап текущей базы
   - Остановит контейнер
   - Скопирует бэкап в контейнер
   - Запустит контейнер обратно

### 4. Управление бэкапами

- **Обновить**: Обновить список бэкапов
- **Удалить выбранный**: Удалить выбранный бэкап из таблицы
- **Очистить старые**: Удалить все бэкапы старше 30 дней

## Структура проекта

```
HomeCenterBackup/
├── Program.cs              - Точка входа
├── MainForm.cs             - Главная форма
├── DockerService.cs        - Работа с Docker
├── BackupService.cs        - Логика бэкапов
└── README.md               - Документация
```

## Архитектура

```
┌─────────────────────────────────────────┐
│      HomeCenterBackup.exe               │
│                                         │
│  ┌──────────────┐   ┌──────────────┐   │
│  │  MainForm    │   │ BackupService│   │
│  │   (UI)       │──▶│   (Logic)    │   │
│  └──────────────┘   └──────┬───────┘   │
│                             │           │
│                      ┌──────▼───────┐   │
│                      │DockerService │   │
│                      │   (Docker)   │   │
│                      └──────┬───────┘   │
└─────────────────────────────┼───────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │  Docker Desktop  │
                    │                  │
                    │  ┌────────────┐  │
                    │  │ homecenter │  │
                    │  │ container  │  │
                    │  └─────┬──────┘  │
                    │        │         │
                    │  ┌─────▼──────┐  │
                    │  │  quiz.db   │  │
                    │  └────────────┘  │
                    └──────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │  backups/        │
                    │  ├── quiz-*.db   │
                    │  └── ...         │
                    └──────────────────┘
```

## Лог операций

Все операции логируются в текстовое поле внизу формы:

```
[15:30:45] Проверка контейнера...
[15:30:46] Проверка базы данных...
[15:30:46] Создание бэкапа: quiz-20240214-153045.db
[15:30:47] ✓ Бэкап создан: quiz-20240214-153045.db (256.50 KB)
[15:30:47] Найдено бэкапов: 5
```

## Безопасность

- Перед восстановлением создаётся бэкап текущей базы (`quiz-before-restore-YYYYMMDD-HHMMSS.db`)
- Все операции требуют подтверждения
- Контейнер автоматически запускается обратно даже при ошибке

## Troubleshooting

### Контейнер не запущен

**Ошибка**: `Контейнер 'homecenter' не запущен!`

**Решение**:
```bash
docker-compose up -d
```

### База данных не найдена

**Ошибка**: `База данных не найдена: /app/data/quiz.db`

**Решение**:
- Проверьте правильность пути к базе данных
- Убедитесь что база данных существует в контейнере:
  ```bash
  docker exec homecenter ls -la /app/data/
  ```

### Docker команда не найдена

**Ошибка**: `Command failed: ...`

**Решение**:
- Убедитесь что Docker Desktop установлен и запущен
- Проверьте что `docker` и `docker-compose` доступны в PATH

## Публикация

### Создать самодостаточный exe

```bash
dotnet publish -c Release -r win-x64 --self-contained true -p:PublishSingleFile=true
```

Результат будет в:
```
bin\Release\net8.0-windows\win-x64\publish\HomeCenterBackup.exe
```

### Создать установщик (опционально)

Можно использовать:
- Inno Setup
- WiX Toolset
- ClickOnce

## Лицензия

MIT
