@model HomeCenter.Models.TestIndexViewModel

<h2 class="card-title h5 mb-3">Тесты в папке: @Model.CurrentFolderDisplay</h2>

@if (!Model.TopicsInFolder.Any())
{
    <p class="text-muted mb-0">
        @if (Model.TotalTopicsInFolder > 0)
        {
            <text>В этой папке есть тесты, но они отключены администратором. Включите их в админке.</text>
        }
        else
        {
            <text>В этой папке пока нет тестов.</text>
        }
    </p>
}
else
{
    <div class="list-group">
        @foreach (var t in Model.TopicsInFolder)
        {
            Model.LastResultsByTopicId.TryGetValue(t.Id, out var last);

            <a class="list-group-item list-group-item-action"
               asp-action="Take" asp-route-id="@t.Id">
                <div class="d-flex w-100 justify-content-between align-items-center">
                    <div>
                        <div class="fw-semibold">@t.Title</div>
                        <div class="small text-muted">
                            Тип: @t.TypeDisplayName
                            @if (last?.LastCompletedAt != null)
                            {
                                <span class="ms-2">
                                    Последний раз: @last.LastCompletedAt.Value.ToLocalTime().ToString("dd.MM.yyyy HH:mm")
                                </span>
                            }
                        </div>
                    </div>
                    <div class="text-end">
                        @if (last?.LastScorePercent != null)
                        {
                            <span class="badge @(last.LastScorePercent >= 70 ? "bg-success" : last.LastScorePercent >= 50 ? "bg-warning" : "bg-danger")">
                                @($"{last.LastScorePercent:F1} %")
                            </span>
                        }
                        else
                        {
                            <span class="badge bg-secondary">без оценки</span>
                        }
                    </div>
                </div>
            </a>
        }
    </div>
}

