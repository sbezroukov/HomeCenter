@model IEnumerable<HomeCenter.Models.Topic>
@using HomeCenter.Models
@using System.IO
@{
    var currentFolder = ViewBag.CurrentFolderPath as string ?? "";
    var includeSubfolders = ViewBag.IncludeSubfolders as bool? ?? true;
    var folderDisplay = ViewBag.FolderDisplay as string ?? "Все темы";
}
@functions {
    string GetFileName(string filePath)
    {
        if (string.IsNullOrEmpty(filePath)) return "";
        return System.IO.Path.GetFileName(filePath.Replace('/', System.IO.Path.DirectorySeparatorChar).Replace('\\', System.IO.Path.DirectorySeparatorChar));
    }
}
<div class="admin-folder-data" data-current-folder="@currentFolder" data-include-subfolders="@(includeSubfolders ? "true" : "false")">
<h2 class="card-title h5 mb-3">@folderDisplay</h2>

@if (!string.IsNullOrEmpty(currentFolder))
{
    <div class="mb-3 d-flex flex-wrap gap-2">
        <div class="btn-group btn-group-sm">
            <a href="#" class="btn btn-outline-secondary js-admin-folder-link @(!includeSubfolders ? "active" : "")"
               data-folder="@currentFolder" data-include-subfolders="false">Только эта папка</a>
            <a href="#" class="btn btn-outline-secondary js-admin-folder-link @(includeSubfolders ? "active" : "")"
               data-folder="@currentFolder" data-include-subfolders="true">С подпапками</a>
        </div>
        <form asp-action="ToggleFolder" method="post" class="d-inline js-toggle-folder-form">
            <input type="hidden" name="folderPath" value="@currentFolder" />
            <input type="hidden" name="includeSubfolders" value="@(includeSubfolders ? "true" : "false")" />
            <input type="hidden" name="enable" value="true" />
            <button type="submit" class="btn btn-sm btn-success">Включить все</button>
        </form>
        <form asp-action="ToggleFolder" method="post" class="d-inline js-toggle-folder-form">
            <input type="hidden" name="folderPath" value="@currentFolder" />
            <input type="hidden" name="includeSubfolders" value="@(includeSubfolders ? "true" : "false")" />
            <input type="hidden" name="enable" value="false" />
            <button type="submit" class="btn btn-sm btn-warning">Выключить все</button>
        </form>
        <form asp-action="DeleteFolder" method="post" class="d-inline js-delete-folder-form"
              data-confirm="Удалить всю папку @(folderDisplay) с диска и из БД?">
            @Html.AntiForgeryToken()
            <input type="hidden" name="folderPath" value="@currentFolder" />
            <input type="hidden" name="includeSubfolders" value="@(includeSubfolders ? "true" : "false")" />
            <button type="submit" class="btn btn-sm btn-outline-danger">Удалить папку</button>
        </form>
    </div>
}

<div class="table-responsive">
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Тема</th>
                <th>Файл</th>
                <th>Тип</th>
                <th>Доступна</th>
                <th>Статус</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var t in Model)
            {
                <tr data-topic-id="@t.Id" class="@(t.IsDeleted ? "table-secondary" : "")">
                    <td>@t.DisplayPath</td>
                    <td><span title="@t.FileName">@GetFileName(t.FileName)</span></td>
                    <td>@t.TypeDisplayName</td>
                    <td class="js-access-status">@(t.IsEnabled ? "Да" : "Нет")</td>
                    <td>
                        @if (t.IsDeleted)
                        {
                            <span class="badge bg-danger">Удалён</span>
                        }
                        else
                        {
                            <span class="text-muted">—</span>
                        }
                    </td>
                    <td>
                        @if (!t.IsDeleted)
                        {
                            <form asp-action="ToggleTopic" method="post" class="d-inline js-toggle-form">
                                <input type="hidden" name="id" value="@t.Id" />
                                <button type="submit" class="btn btn-sm @(t.IsEnabled ? "btn-warning" : "btn-success")">
                                    @(t.IsEnabled ? "Сделать недоступной" : "Сделать доступной")
                                </button>
                            </form>
                        }
                        <form asp-action="DeleteTopic" method="post" class="d-inline js-delete-topic-form"
                              data-confirm="Удалить тест «@t.Title» из БД?">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="id" value="@t.Id" />
                            <button type="submit" class="btn btn-sm btn-outline-danger">Удалить из БД</button>
                        </form>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>
</div>
