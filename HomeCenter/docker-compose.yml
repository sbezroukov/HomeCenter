version: '3.8'

services:
  homecenter:
    build:
      context: .
      dockerfile: Dockerfile
    image: homecenter
    container_name: homecenter
    ports:
      - "8080:8080"
    restart: unless-stopped
    volumes:
      - quizdb:/app/data
      - ./tests:/app/tests
      - ./Schoolbook:/app/Schoolbook
    environment:
      - ASPNETCORE_ENVIRONMENT=Production
      - ASPNETCORE_URLS=http://+:8080
      - ConnectionStrings__DefaultConnection=Data Source=/app/data/quiz.db
      # Admin credentials (reads from .env file with Admin__Username format)
      - Admin__Username=${Admin__Username:-admin}
      - Admin__Password=${Admin__Password:-change-me}
      # AI Configuration (reads from .env file with AI__ApiKey format)
      - AI__Provider=${AI__Provider:-OpenRouter}
      - AI__ApiKey=${AI__ApiKey}
      - AI__Enabled=${AI__Enabled:-true}
      - AI__Model=${AI__Model:-openrouter/free}
      - AI__BaseUrl=${AI__BaseUrl:-https://openrouter.ai/api/v1}
      # Qwen Configuration (optional, reads from .env file with Qwen__ApiKey format)
      - Qwen__ApiKey=${Qwen__ApiKey}
      - Qwen__Enabled=${Qwen__Enabled:-false}
      - Qwen__Model=${Qwen__Model:-qwen-turbo}
      - Qwen__BaseUrl=${Qwen__BaseUrl:-https://dashscope-intl.aliyuncs.com/api/v1}

  sqlite-web:
    image: coleifer/sqlite-web
    container_name: homecenter-sqlite-web
    ports:
      - "8050:8080"
    restart: unless-stopped
    volumes:
      - quizdb:/data
    environment:
      - SQLITE_DATABASE=quiz.db
    command: ["-H", "0.0.0.0", "-x", "/data/quiz.db"]
    depends_on:
      - homecenter

volumes:
  quizdb:
