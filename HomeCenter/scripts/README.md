# Скрипты для управления бэкапами

Простые PowerShell скрипты для резервного копирования SQLite базы данных в Docker Desktop.

## Быстрый старт

```powershell
# Создать бэкап
.\backup.ps1

# Посмотреть список бэкапов
.\list-backups.ps1

# Восстановить из последнего бэкапа
.\restore.ps1

# Настроить автоматический бэкап (требует права Администратора)
.\auto-backup.ps1
```

## Описание скриптов

### backup.ps1

Создаёт бэкап базы данных из Docker контейнера.

**Что делает:**
- Проверяет что контейнер запущен
- Копирует `/app/data/quiz.db` из контейнера
- Сохраняет в `.\backups\quiz-YYYYMMDD-HHMMSS.db`
- Показывает список всех бэкапов
- Предлагает удалить старые бэкапы (>30 дней)

**Использование:**
```powershell
.\backup.ps1
```

### restore.ps1

Восстанавливает базу данных из бэкапа.

**Что делает:**
- Находит последний бэкап (или использует указанный)
- Запрашивает подтверждение
- Создаёт бэкап текущей базы
- Останавливает контейнер
- Копирует бэкап в контейнер
- Запускает контейнер

**Использование:**
```powershell
# Восстановить из последнего бэкапа
.\restore.ps1

# Восстановить из конкретного файла
.\restore.ps1 -BackupFile .\backups\quiz-20240214-120000.db
```

### list-backups.ps1

Показывает список всех доступных бэкапов.

**Что показывает:**
- Имя файла
- Размер
- Дата создания
- Возраст (сколько времени назад)
- Общая статистика

**Использование:**
```powershell
.\list-backups.ps1
```

### auto-backup.ps1

Настраивает автоматический бэкап через Windows Task Scheduler.

**Что делает:**
- Создаёт задачу в Task Scheduler
- Запуск каждый день в 2:00 ночи
- Использует `backup.ps1` для создания бэкапа

**Требования:**
- PowerShell запущен от имени Администратора

**Использование:**
```powershell
# Запустить PowerShell от имени Администратора
.\auto-backup.ps1
```

**Управление задачей:**
1. Открыть Task Scheduler: `Win+R` → `taskschd.msc`
2. Найти "HomeCenter Database Backup"
3. Правый клик → Выполнить / Отключить / Удалить

## Где хранятся бэкапы

Все бэкапы сохраняются в:

```
C:\HomeRepositories\HomeCenter\HomeCenter\backups\
  ├── quiz-20240214-153045.db
  ├── quiz-20240214-120000.db
  └── quiz-20240213-020000.db
```

Директория `backups\` добавлена в `.gitignore` и не коммитится.

## Примеры использования

### Перед обновлением

```powershell
# Создать бэкап перед обновлением
.\backup.ps1

# Обновить приложение
cd ..
docker-compose down
docker-compose up -d --build

# Если что-то сломалось
cd scripts
.\restore.ps1
```

### Перенос на другой компьютер

**Старый компьютер:**
```powershell
.\backup.ps1
# Скопировать файл из .\backups\ на флешку
```

**Новый компьютер:**
```powershell
# Запустить приложение
docker-compose up -d

# Скопировать бэкап в .\backups\
mkdir backups
copy D:\backup\quiz-20240214.db .\backups\

# Восстановить
cd scripts
.\restore.ps1 -BackupFile ..\backups\quiz-20240214.db
```

### Регулярное обслуживание

```powershell
# Раз в неделю проверять бэкапы
.\list-backups.ps1

# Раз в месяц тестировать восстановление
.\restore.ps1

# Раз в квартал скачивать бэкапы в облако
Copy-Item .\backups\quiz-*.db D:\GoogleDrive\HomeCenter-Backups\
```

## Troubleshooting

### Контейнер не запущен

```powershell
# Запустить контейнер
cd ..
docker-compose up -d

# Проверить
docker ps
```

### Нет прав Администратора

Для `auto-backup.ps1`:

1. Закрыть PowerShell
2. Правый клик → "Запуск от имени администратора"
3. Перейти в директорию
4. Запустить снова

### Бэкап не создаётся

```powershell
# Проверить контейнер
docker ps | findstr homecenter

# Проверить базу данных
docker exec homecenter ls -la /app/data/

# Проверить права
Test-Path ..\backups -PathType Container
```

## Дополнительно

Полное руководство: **[../BACKUP-GUIDE.md](../BACKUP-GUIDE.md)**
